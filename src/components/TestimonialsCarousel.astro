---
import { TESTIMONIALS } from "../utils/constanst";
---

<div class="  ">
  <div class="swiper testimonials-swiper">
    <div class="swiper-wrapper">
      {TESTIMONIALS.map((testimonial) => (
        <div class="swiper-slide">
          <div class=" rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 h-full">
            
            <div class="relative aspect-video ">
              <video 
                class="testimonial-video w-full h-full object-cover"
                poster={testimonial.thumbnail}
                preload="none"
                muted
              >
                <source src={testimonial.videoUrl} type="video/mp4">
              </video>
              
              
              <div class="play-button absolute inset-0 flex items-center justify-center bg-black/20 cursor-pointer hover:bg-black/10 transition-colors">
                <div class="bg-white rounded-full p-4 shadow-lg hover:scale-105 transition-transform">
                  <svg class="w-8 h-8 text-sky-600 ml-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                </div>
              </div>
              
              
              <div class="absolute top-4 left-4 bg-sky-600 text-white text-xs font-semibold px-3 py-1.5 rounded-lg">
                â–¶ Testimonio
              </div>
            </div>
            
           
            <div class="p-6">
              
              <div class="flex items-center space-x-4 mb-4">
                <div class="relative">
                  <img 
                    src={testimonial.thumbnail} 
                    alt={testimonial.name}
                    class="w-14 h-14 rounded-full object-cover border-3 border-sky-200"
                    loading="lazy"
                  >
                  <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-cyan-400 border-2 border-white rounded-full"></div>
                </div>
                <div class="flex-1">
                  <h3 class="text-lg font-bold text-gray-900">{testimonial.name}</h3>
                  <p class="text-sky-600 font-medium">{testimonial.role}</p>
                </div>
              </div>
              
              <blockquote class="relative">
                <div class="absolute -top-2 -left-2 text-3xl text-sky-200 font-serif leading-none">"</div>
                <p class="text-gray-700 leading-relaxed pl-6 pr-4 italic">
                  {testimonial.quote}
                </p>
                <div class="absolute -bottom-4 -right-2 text-3xl text-sky-200 font-serif leading-none rotate-180">"</div>
              </blockquote>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <!-- Pagination -->
    <div class="swiper-pagination mt-8"></div>
    
    <!-- Navigation -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
</div>

<style>
  @import 'swiper/css';
  @import 'swiper/css/navigation';
  @import 'swiper/css/pagination';
  
  .testimonials-swiper {
    padding: 0 50px 40px 50px;
  }
  
  .testimonial-video::-webkit-media-controls {
    display: none !important;
  }
  
  .testimonial-video::-webkit-media-controls-enclosure {
    display: none !important;
  }
  
  /* Pagination */
  .swiper-pagination-bullet {
    background: rgba(14, 165, 233, 0.4) !important;
    width: 12px !important;
    height: 12px !important;
    opacity: 1 !important;
    margin: 0 4px !important;
  }
  
  .swiper-pagination-bullet-active {
    background: #0ea5e9 !important;
    transform: scale(1.3) !important;
  }
  
  /* Navigation */
  .swiper-button-prev,
  .swiper-button-next {
    background: white !important;
    width: 44px !important;
    height: 44px !important;
    margin-top: -22px !important;
    border-radius: 50% !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    color: #0ea5e9 !important;
    transition: all 0.3s ease !important;
  }
  
  .swiper-button-prev:hover,
  .swiper-button-next:hover {
    background: #f0f9ff !important;
    transform: scale(1.1) !important;
    box-shadow: 0 6px 20px rgba(14, 165, 233, 0.3) !important;
  }
  
  .swiper-button-prev::after,
  .swiper-button-next::after {
    font-size: 18px !important;
    font-weight: bold !important;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .testimonials-swiper {
      padding: 0 20px 40px 20px;
    }
    
    .swiper-button-prev,
    .swiper-button-next {
      width: 36px !important;
      height: 36px !important;
      margin-top: -18px !important;
    }
    
    .swiper-button-prev::after,
    .swiper-button-next::after {
      font-size: 14px !important;
    }
  }
</style>

<script>
  import { Swiper } from 'swiper';
  import { Navigation, Pagination, Autoplay } from 'swiper/modules';
  
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Swiper
    new Swiper('.testimonials-swiper', {
      modules: [Navigation, Pagination, Autoplay],
      slidesPerView: 1,
      spaceBetween: 30,
      loop: true,
      autoplay: {
        delay: 5000,
        disableOnInteraction: false,
      },
      breakpoints: {
        768: {
          slidesPerView: 2,
          spaceBetween: 30,
        },
        1024: {
          slidesPerView: 3,
          spaceBetween: 40,
        },
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
    });
    
    // Video handling
    document.querySelectorAll('.play-button').forEach(playButton => {
      const video = playButton.closest('.relative')?.querySelector('.testimonial-video') as HTMLVideoElement;
      
      if (!video) return;
      
      playButton.addEventListener('click', () => {
        if (video.paused) {
          
          document.querySelectorAll('.testimonial-video').forEach(v => {
            const videoEl = v as HTMLVideoElement;
            if (videoEl !== video) {
              videoEl.pause();
              const playBtn = videoEl.closest('.relative')?.querySelector('.play-button') as HTMLElement;
              if (playBtn) playBtn.style.display = 'flex';
            }
          });
          
          video.play();
          (playButton as HTMLElement).style.display = 'none';
        }
      });
      
      // Si el video se esta reproduciendo, pausar el carousel
      video.addEventListener('play', () => {
        const swiper = document.querySelector('.testimonials-swiper') as unknown as Swiper;
        if (swiper) swiper.autoplay.stop();
      });
      
      


      video.addEventListener('click', () => {
        if (!video.paused) {
          video.pause();
          (playButton as HTMLElement).style.display = 'flex';
        }
      });
      
      video.addEventListener('ended', () => {
        (playButton as HTMLElement).style.display = 'flex';
        video.currentTime = 0;
      });
    });
  });
</script>